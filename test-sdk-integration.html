<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Whisperer SDK Integration Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 10px 20px; margin: 5px; }
        #logs { background: #f8f9fa; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîç User Whisperer SDK Integration Test</h1>
    
    <div class="status info">
        <strong>Current Configuration:</strong><br>
        API Endpoint: <span id="endpoint">Loading...</span><br>
        SDK Version: <span id="version">Loading...</span><br>
        Status: <span id="status">Initializing...</span>
    </div>

    <h2>Test Actions</h2>
    <button onclick="testBasicTracking()">üìä Test Basic Event Tracking</button>
    <button onclick="testUserIdentification()">üë§ Test User Identification</button>
    <button onclick="testCustomEvents()">üéØ Test Custom Events</button>
    <button onclick="testBatchingAndFlushing()">üì¶ Test Batching & Flushing</button>
    <button onclick="testErrorHandling()">‚ùå Test Error Handling</button>
    <button onclick="runFullIntegrationTest()">üöÄ Run Full Integration Test</button>

    <h2>Event Logs</h2>
    <div id="logs"></div>

    <script src="./sdk/javascript/lib/userwhisperer.js"></script>
    <script>
        let uw;
        const logs = document.getElementById('logs');
        
        // Initialize SDK
        try {
            uw = new UserWhisperer({
                apiKey: 'test-api-key-12345',
                appId: 'test-app',
                endpoint: 'https://api.userwhisperer.ai', // Production endpoint
                debug: true,
                batchSize: 5,
                flushInterval: 2000
            });
            
            document.getElementById('endpoint').textContent = uw.endpoint;
            document.getElementById('version').textContent = '1.0.0';
            document.getElementById('status').textContent = 'Ready';
            
            log('‚úÖ SDK initialized successfully', 'success');
        } catch (error) {
            log('‚ùå SDK initialization failed: ' + error.message, 'error');
            document.getElementById('status').textContent = 'Failed';
        }

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `status ${type}`;
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
        }

        function testBasicTracking() {
            log('üß™ Testing basic event tracking...', 'info');
            
            try {
                uw.track('page_view', {
                    page_title: 'SDK Test Page',
                    page_url: window.location.href,
                    referrer: document.referrer
                });
                
                uw.track('button_click', {
                    button_name: 'Test Basic Tracking',
                    timestamp: new Date().toISOString()
                });
                
                log('‚úÖ Basic tracking events sent', 'success');
            } catch (error) {
                log('‚ùå Basic tracking failed: ' + error.message, 'error');
            }
        }

        function testUserIdentification() {
            log('üß™ Testing user identification...', 'info');
            
            try {
                uw.identify('test-user-12345', {
                    email: 'testuser@example.com',
                    name: 'Test User',
                    plan: 'free',
                    signupDate: '2024-01-01'
                });
                
                log('‚úÖ User identification successful', 'success');
            } catch (error) {
                log('‚ùå User identification failed: ' + error.message, 'error');
            }
        }

        function testCustomEvents() {
            log('üß™ Testing custom events...', 'info');
            
            try {
                // E-commerce events
                uw.track('product_viewed', {
                    product_id: 'prod-123',
                    product_name: 'Premium Plan',
                    category: 'subscription',
                    price: 29.99
                });
                
                // Feature usage events
                uw.track('feature_used', {
                    feature_name: 'ai_content_generation',
                    usage_count: 1,
                    success: true
                });
                
                // Engagement events
                uw.track('engagement_score', {
                    score: 0.85,
                    factors: ['email_opens', 'click_through', 'time_on_page']
                });
                
                log('‚úÖ Custom events sent successfully', 'success');
            } catch (error) {
                log('‚ùå Custom events failed: ' + error.message, 'error');
            }
        }

        function testBatchingAndFlushing() {
            log('üß™ Testing batching and flushing...', 'info');
            
            try {
                // Send multiple events quickly to test batching
                for (let i = 0; i < 8; i++) {
                    uw.track('batch_test_event', {
                        event_number: i + 1,
                        timestamp: Date.now()
                    });
                }
                
                log('üì¶ Sent 8 events for batch testing', 'info');
                
                // Force flush
                setTimeout(() => {
                    uw.flush();
                    log('üíæ Forced flush executed', 'info');
                }, 1000);
                
                log('‚úÖ Batching and flushing test completed', 'success');
            } catch (error) {
                log('‚ùå Batching test failed: ' + error.message, 'error');
            }
        }

        function testErrorHandling() {
            log('üß™ Testing error handling...', 'info');
            
            try {
                // Test invalid event data
                uw.track('', null);
                log('‚ö†Ô∏è Invalid event data handled gracefully', 'info');
                
                // Test extremely large payload
                const largeData = { bigData: 'x'.repeat(10000) };
                uw.track('large_payload_test', largeData);
                log('‚ö†Ô∏è Large payload handled', 'info');
                
                log('‚úÖ Error handling tests passed', 'success');
            } catch (error) {
                log('‚ùå Error handling test failed: ' + error.message, 'error');
            }
        }

        async function runFullIntegrationTest() {
            log('üöÄ Starting full integration test...', 'info');
            
            try {
                // 1. Initialize user session
                uw.identify('integration-test-user', {
                    email: 'integration@test.com',
                    plan: 'premium',
                    testMode: true
                });
                
                // 2. Simulate user journey
                const userJourney = [
                    { event: 'app_opened', properties: { source: 'direct' } },
                    { event: 'dashboard_viewed', properties: { section: 'analytics' } },
                    { event: 'feature_explored', properties: { feature: 'ai_insights' } },
                    { event: 'action_taken', properties: { action: 'generate_content' } },
                    { event: 'result_viewed', properties: { satisfaction: 'high' } }
                ];
                
                for (const step of userJourney) {
                    uw.track(step.event, {
                        ...step.properties,
                        journey_step: userJourney.indexOf(step) + 1,
                        timestamp: Date.now()
                    });
                    
                    // Small delay to simulate real user behavior
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                // 3. Test performance tracking
                uw.track('performance_metric', {
                    page_load_time: 1200,
                    first_contentful_paint: 800,
                    largest_contentful_paint: 1100
                });
                
                // 4. Force final flush
                uw.flush();
                
                log('üéâ Full integration test completed successfully!', 'success');
                log('üìä Check your User Whisperer dashboard for test data', 'info');
                
            } catch (error) {
                log('‚ùå Integration test failed: ' + error.message, 'error');
            }
        }

        // Auto-run basic test on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testBasicTracking();
            }, 1000);
        });
    </script>
</body>
</html>
